<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/mountain.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/mountain.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/mountain.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="我的精神家园">
<meta property="og:type" content="website">
<meta property="og:title" content="木鱼的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="木鱼的博客">
<meta property="og:description" content="我的精神家园">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="木鱼">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>木鱼的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">木鱼的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">蜀道之难，难于上青天</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-track">

    <a href="/track/" rel="section"><i class="fa fa-fw fa-car"></i>足迹</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/20/macho-read-byte/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/macho-read-byte/" class="post-title-link" itemprop="url">Mach-O 可重定向目标文件剖析</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-20 20:01:41" itemprop="dateCreated datePublished" datetime="2020-05-20T20:01:41+08:00">2020-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 10:35:35" itemprop="dateModified" datetime="2020-05-21T10:35:35+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>目标文件，又称为可重定向目标文件，是源代码经编译之后的产物。目标文件是可执行文件、静态库、共享库的原材料。MacOS 系统的目标文件采用的是 Mach-O 格式。本文以一个简单的可重定向文件为例来描述 Mach-O 格式。</p>
<h2 id="生成目标文件"><a href="#生成目标文件" class="headerlink" title="生成目标文件"></a>生成目标文件</h2><p>新建 main.c 文件<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.c</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译 main.c 得到 main.o 文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -c main.c -o main.o</span><br></pre></td></tr></table></figure>
<h2 id="查看目标文件"><a href="#查看目标文件" class="headerlink" title="查看目标文件"></a>查看目标文件</h2><p>文件的本质，包括 main.o 在内，实际上是数据的集合。通过 xxd 查看该文件的十六进制形式<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd main.o</span><br></pre></td></tr></table></figure></p>
<p><code>main.o</code> 的十六进制形式的完整数据如下，其中第一列的十六进制数字代表所在行的偏移量，用来方便的定位数据；第二列到第九列为文件数据；最右为数据的 <a href="https://tools.ietf.org/html/rfc1642" target="_blank" rel="noopener">ASCII</a> 表示，非 ASCII 码显示为 <code>.</code>。比如第一行开始数据 <code>cf</code> 的偏移量为 <code>0x00000000</code>，数据 <code>fa</code> 的偏移量则为 <code>0x00000001</code>。了解了数据以及偏移量，我们就知道如何读文件了。在下文我会用 <code>offset</code> 代表偏移量，接下来我们可以按照字节来解析 main.o 文件了。<br>这种原始的读取方式，可以让我们加深对文件的理解，读者也可以采用 <a href="https://github.com/gdbinit/MachOView" target="_blank" rel="noopener">MachOView</a> 来查看，更加直观方便。<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span>: cffa edfe <span class="number">0700</span> <span class="number">0001</span> <span class="number">0300</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000010</span>: <span class="number">0400</span> <span class="number">0000</span> b801 <span class="number">0000</span> <span class="number">0020</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ......... ......</span><br><span class="line"><span class="number">00000020</span>: <span class="number">1900</span> <span class="number">0000</span> <span class="number">3801</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ...<span class="number">.8</span>...........</span><br><span class="line"><span class="number">00000030</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000040</span>: <span class="number">7800</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> d801 <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  x...............</span><br><span class="line"><span class="number">00000050</span>: <span class="number">7800</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0700</span> <span class="number">0000</span> <span class="number">0700</span> <span class="number">0000</span>  x...............</span><br><span class="line"><span class="number">00000060</span>: <span class="number">0300</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">5f</span>5f <span class="number">7465</span> <span class="number">7874</span> <span class="number">0000</span>  ........__text..</span><br><span class="line"><span class="number">00000070</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">5f</span>5f <span class="number">5445</span> <span class="number">5854</span> <span class="number">0000</span>  ........__TEXT..</span><br><span class="line"><span class="number">00000080</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000090</span>: <span class="number">1200</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> d801 <span class="number">0000</span> <span class="number">0400</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000000</span>a0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0004</span> <span class="number">0080</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000000</span>b0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">5f</span>5f <span class="number">636f</span> <span class="number">6</span>d70 <span class="number">6163</span>  ........__compac</span><br><span class="line"><span class="number">000000</span>c0: <span class="number">745f</span> <span class="number">756</span>e <span class="number">7769</span> <span class="number">6e64</span> <span class="number">5f</span>5f <span class="number">4</span>c44 <span class="number">0000</span> <span class="number">0000</span>  t_unwind__LD....</span><br><span class="line"><span class="number">000000</span>d0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1800</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000000e0</span>: <span class="number">2000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> f001 <span class="number">0000</span> <span class="number">0300</span> <span class="number">0000</span>   ...............</span><br><span class="line"><span class="number">000000f</span>0: <span class="number">5002</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0002</span> <span class="number">0000</span> <span class="number">0000</span>  P...............</span><br><span class="line"><span class="number">00000100</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">5f</span>5f <span class="number">6568</span> <span class="number">5f</span>66 <span class="number">7261</span>  ........__eh_fra</span><br><span class="line"><span class="number">00000110</span>: <span class="number">6</span>d65 <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">5f</span>5f <span class="number">5445</span> <span class="number">5854</span> <span class="number">0000</span>  me......__TEXT..</span><br><span class="line"><span class="number">00000120</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">3800</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  .......<span class="number">.8</span>.......</span><br><span class="line"><span class="number">00000130</span>: <span class="number">4000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1002</span> <span class="number">0000</span> <span class="number">0300</span> <span class="number">0000</span>  @...............</span><br><span class="line"><span class="number">00000140</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0</span>b00 <span class="number">0068</span> <span class="number">0000</span> <span class="number">0000</span>  ...........h....</span><br><span class="line"><span class="number">00000150</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">3200</span> <span class="number">0000</span> <span class="number">1800</span> <span class="number">0000</span>  .......<span class="number">.2</span>.......</span><br><span class="line"><span class="number">00000160</span>: <span class="number">0100</span> <span class="number">0000</span> <span class="number">000f</span> <span class="number">0</span>a00 <span class="number">040f</span> <span class="number">0</span>a00 <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000170</span>: <span class="number">0200</span> <span class="number">0000</span> <span class="number">1800</span> <span class="number">0000</span> <span class="number">5802</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0000</span>  ........X.......</span><br><span class="line"><span class="number">00000180</span>: <span class="number">6802</span> <span class="number">0000</span> <span class="number">0800</span> <span class="number">0000</span> <span class="number">0</span>b00 <span class="number">0000</span> <span class="number">5000</span> <span class="number">0000</span>  h...........P...</span><br><span class="line"><span class="number">00000190</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000001</span>a0: <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000001</span>b0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000001</span>c0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000001</span>d0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">5548</span> <span class="number">89e5</span> c745 fc00  ........UH...E..</span><br><span class="line"><span class="number">000001e0</span>: <span class="number">0000</span> <span class="number">00</span>b8 <span class="number">0200</span> <span class="number">0000</span> <span class="number">5</span>dc3 <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ........].......</span><br><span class="line"><span class="number">000001f</span>0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1200</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0001</span>  ................</span><br><span class="line"><span class="number">00000200</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000210</span>: <span class="number">1400</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">017</span>a <span class="number">5200</span> <span class="number">0178</span> <span class="number">1001</span>  .........zR..x..</span><br><span class="line"><span class="number">00000220</span>: <span class="number">100</span>c <span class="number">0708</span> <span class="number">9001</span> <span class="number">0000</span> <span class="number">2400</span> <span class="number">0000</span> <span class="number">1</span>c00 <span class="number">0000</span>  ........$.......</span><br><span class="line"><span class="number">00000230</span>: a8ff ffff ffff ffff <span class="number">1200</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000240</span>: <span class="number">0041</span> <span class="number">0e10</span> <span class="number">8602</span> <span class="number">430</span>d <span class="number">0600</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  .A....C.........</span><br><span class="line"><span class="number">00000250</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0006</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">0f</span>01 <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000260</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">005f</span> <span class="number">6</span>d61 <span class="number">696</span>e <span class="number">0000</span>  ........._main..</span><br></pre></td></tr></table></figure></p>
<h3 id="Mach-Header"><a href="#Mach-Header" class="headerlink" title="Mach Header"></a>Mach Header</h3><p>Mach-O 文件的开头是个 header，32 位下按照结构体 <code>mach_header</code> 布局，64 位下是 <code>mach_header_64</code>。可以在 apple 开源的 <a href="https://opensource.apple.com/source/cctools/cctools-795/include/mach-o/loader.h" target="_blank" rel="noopener">mach-o/loader.h</a> 里找到详细的结构体信息。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The 32-bit mach header appears at the very beginning of the object file for</span></span><br><span class="line"><span class="comment"> * 32-bit architectures.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mach_header</span> &#123;</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	magic;		<span class="comment">/* mach magic number identifier */</span></span><br><span class="line">	<span class="keyword">cpu_type_t</span>	cputype;	<span class="comment">/* cpu specifier */</span></span><br><span class="line">	<span class="keyword">cpu_subtype_t</span>	cpusubtype;	<span class="comment">/* machine specifier */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	filetype;	<span class="comment">/* type of file */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	ncmds;		<span class="comment">/* number of load commands */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	sizeofcmds;	<span class="comment">/* the size of all the load commands */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Constant for the magic field of the mach_header (32-bit architectures) */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_MAGIC	0xfeedface	<span class="comment">/* the mach magic number */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_CIGAM	0xcefaedfe	<span class="comment">/* NXSwapInt(MH_MAGIC) */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The 64-bit mach header appears at the very beginning of object files for</span></span><br><span class="line"><span class="comment"> * 64-bit architectures.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mach_header_64</span> &#123;</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	magic;		<span class="comment">/* mach magic number identifier */</span></span><br><span class="line">	<span class="keyword">cpu_type_t</span>	cputype;	<span class="comment">/* cpu specifier */</span></span><br><span class="line">	<span class="keyword">cpu_subtype_t</span>	cpusubtype;	<span class="comment">/* machine specifier */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	filetype;	<span class="comment">/* type of file */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	ncmds;		<span class="comment">/* number of load commands */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	sizeofcmds;	<span class="comment">/* the size of all the load commands */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	reserved;	<span class="comment">/* reserved */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Constant for the magic field of the mach_header_64 (64-bit architectures) */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_MAGIC_64 0xfeedfacf <span class="comment">/* the 64-bit mach magic number */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_CIGAM_64 0xcffaedfe <span class="comment">/* NXSwapInt(MH_MAGIC_64) */</span></span></span><br></pre></td></tr></table></figure></p>
<p>不论是 <code>mach_header</code> 还是 <code>mach_header_64</code>，其开头都是一个 <code>uint32_t</code> 的成员 <code>magic</code>，读文件前 4 个字节来查看 <code>magic</code> 的值<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span>: cffa edfe</span><br></pre></td></tr></table></figure></p>
<p>即 <code>cffa edfe</code>，MacOS 是小端序，需要反过来读，值为 <code>0xfeedfacf</code>，与 <code>MH_MAGIC_64</code> 相等，代表 64 位的 Mach-O 文件。确定了 <code>magic</code> 之后，可以参照 <code>mach_header_64</code> 接着往下解析，读出其余成员的值。</p>
<table>
<thead>
<tr>
<th>name</th>
<th>offset</th>
<th>value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>magic</td>
<td>0x0</td>
<td>0xfeedfacf</td>
<td>MH_MAGIC_64</td>
</tr>
<tr>
<td>cputype</td>
<td>0x4</td>
<td>0x01000007</td>
<td>CPU_TYPE_X86_64</td>
</tr>
<tr>
<td>cpusubtype：</td>
<td>0x8</td>
<td>0x00000003</td>
<td>CPU_SUBTYPE_X86_64_ALL</td>
</tr>
<tr>
<td>filetype</td>
<td>0xc</td>
<td>0x00000001</td>
<td>MH_OBJECT，代表可重定位目标文件</td>
</tr>
<tr>
<td>ncmds</td>
<td>0x10</td>
<td>0x00000004</td>
<td>代表有 4 条 Load Commands</td>
</tr>
<tr>
<td>sizeofcmds</td>
<td>0x14</td>
<td>0x000001b8</td>
<td>表示 Load Commands 的size</td>
</tr>
<tr>
<td>flags</td>
<td>0x18</td>
<td>0x00002000</td>
<td>MH_SUBSECTIONS_VIA_SYMBOLS</td>
</tr>
<tr>
<td>reserved</td>
<td>0x1c</td>
<td>0x00000000</td>
<td>保留字</td>
</tr>
</tbody>
</table>
<h3 id="Load-Commands"><a href="#Load-Commands" class="headerlink" title="Load Commands"></a>Load Commands</h3><p>紧接着 mach_header，就是 Load Commands 了。同样是先读取头文件，从 <code>ncmds</code> 可以看出接下来会存在 4 个 <code>load_command</code> ，其结构如下<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">load_command</span> &#123;</span></span><br><span class="line">	<span class="keyword">uint32_t</span> cmd;		<span class="comment">/* type of load command */</span></span><br><span class="line">	<span class="keyword">uint32_t</span> cmdsize;	<span class="comment">/* total size of command in bytes */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>cmd</code> 表示 <code>load_command</code> 的类型，根据类型来使用不同的结构来解析。<code>cmdsize</code> 表示该 <code>load_command</code> 的 size，通过 <code>offset + size</code> 可以得出下个 <code>load_command</code> 的 <code>offset</code> 地址。main.o 文件的四个 <code>load_command</code> 如下，Load Commands 紧接着 mach_header，所以第一个 <code>load_command</code> 的 <code>offset</code> 就是 <code>mach_header_64</code> 的 size 0x20。</p>
<table>
<thead>
<tr>
<th>index</th>
<th>cmd offset</th>
<th>cmd value</th>
<th>cmdsize offset</th>
<th>cmdsize value</th>
<th>type</th>
<th>next cmd offset</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0x00000020</td>
<td>0x0000019</td>
<td>0x00000024</td>
<td>0x00000138</td>
<td>LC_SEGMENT_64</td>
<td>0x00000158</td>
</tr>
<tr>
<td>1</td>
<td>0x00000158</td>
<td>0x00000032</td>
<td>0x0000015c</td>
<td>0x00000018</td>
<td>LC_BUILD_VERSION</td>
<td>0x00000170</td>
</tr>
<tr>
<td>2</td>
<td>0x00000170</td>
<td>0x00000002</td>
<td>0x0000174</td>
<td>0x00000018</td>
<td>LC_SYMTAB</td>
<td>0x00000188</td>
</tr>
<tr>
<td>3</td>
<td>0x00000188</td>
<td>0x0000000b</td>
<td>0x000018c</td>
<td>0x00000050</td>
<td>LC_DYSYMTAB</td>
<td>无</td>
</tr>
</tbody>
</table>
<h4 id="LC-SEGMENT-64"><a href="#LC-SEGMENT-64" class="headerlink" title="LC_SEGMENT_64"></a>LC_SEGMENT_64</h4><p>第一个 <code>load_command</code> 类型是 <code>LC_SEGMENT_64</code>，从 <a href="https://opensource.apple.com/source/cctools/cctools-795/include/mach-o/loader.h" target="_blank" rel="noopener">mach-o/loader.h</a> 可以查到其数据结构<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The 64-bit segment load command indicates that a part of this file is to be</span></span><br><span class="line"><span class="comment"> * mapped into a 64-bit task's address space.  If the 64-bit segment has</span></span><br><span class="line"><span class="comment"> * sections then section_64 structures directly follow the 64-bit segment</span></span><br><span class="line"><span class="comment"> * command and their size is reflected in cmdsize.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segment_command_64</span> &#123;</span> <span class="comment">/* for 64-bit architectures */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	cmd;		<span class="comment">/* LC_SEGMENT_64 */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	cmdsize;	<span class="comment">/* includes sizeof section_64 structs */</span></span><br><span class="line">	<span class="keyword">char</span>		segname[<span class="number">16</span>];	<span class="comment">/* segment name */</span></span><br><span class="line">	<span class="keyword">uint64_t</span>	vmaddr;		<span class="comment">/* memory address of this segment */</span></span><br><span class="line">	<span class="keyword">uint64_t</span>	vmsize;		<span class="comment">/* memory size of this segment */</span></span><br><span class="line">	<span class="keyword">uint64_t</span>	fileoff;	<span class="comment">/* file offset of this segment */</span></span><br><span class="line">	<span class="keyword">uint64_t</span>	filesize;	<span class="comment">/* amount to map from the file */</span></span><br><span class="line">	<span class="keyword">vm_prot_t</span>	maxprot;	<span class="comment">/* maximum VM protection */</span></span><br><span class="line">	<span class="keyword">vm_prot_t</span>	initprot;	<span class="comment">/* initial VM protection */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	nsects;		<span class="comment">/* number of sections in segment */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>解析出来值如下表，根据 <code>nsects</code> 可以看出该 segment 包含有 3 个 Section，接下来我们看 Section。</p>
<table>
<thead>
<tr>
<th>name</th>
<th>offset</th>
<th>value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cmd</td>
<td>0x00000020</td>
<td>0x00000019</td>
<td>LC_SEGMENT_64</td>
</tr>
<tr>
<td>cmdsize</td>
<td>0x00000024</td>
<td>0x00000138</td>
<td>该 command 所占的 size</td>
</tr>
<tr>
<td>segname</td>
<td>0x00000028</td>
<td>0</td>
<td>16 位长度的字符串</td>
</tr>
<tr>
<td>vmaddr</td>
<td>0x00000038</td>
<td>0</td>
<td>VM Address</td>
</tr>
<tr>
<td>vmsize</td>
<td>0x00000040</td>
<td>0x0000000000000078</td>
<td>VM Size</td>
</tr>
<tr>
<td>fileoff</td>
<td>0x00000048</td>
<td>0x00000000000001d8</td>
<td>main.o 文件里的偏移量 offset</td>
</tr>
<tr>
<td>filesize</td>
<td>0x00000050</td>
<td>0x0000000000000078</td>
<td>File Size</td>
</tr>
<tr>
<td>maxprot</td>
<td>0x00000058</td>
<td>0x00000007</td>
<td>Maximum VM Protection,VM_PORT_READ,VM_PORT_WRITE,VM_PORT_EXECUTE</td>
</tr>
<tr>
<td>initprot</td>
<td>0x0000005c</td>
<td>0x00000007</td>
<td>Maximum VM Protection,VM_PORT_READ,VM_PORT_WRITE,VM_PORT_EXECUTE</td>
</tr>
<tr>
<td>nsects</td>
<td>0x00000060</td>
<td>0x00000003</td>
<td>Section 的数量，包含 3 个 Section</td>
</tr>
<tr>
<td>flags</td>
<td>0x00000064</td>
<td>0x00000000</td>
<td>Flags</td>
</tr>
</tbody>
</table>
<h4 id="Section"><a href="#Section" class="headerlink" title="Section"></a>Section</h4><p>同样，第一个 Section 的 header 紧挨着 <code>segment_command_64</code>，从 <code>0x00000068</code> 开始解析，其结构如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">section_64</span> &#123;</span> <span class="comment">/* for 64-bit architectures */</span></span><br><span class="line">	<span class="keyword">char</span>		sectname[<span class="number">16</span>];	<span class="comment">/* name of this section */</span></span><br><span class="line">	<span class="keyword">char</span>		segname[<span class="number">16</span>];	<span class="comment">/* segment this section goes in */</span></span><br><span class="line">	<span class="keyword">uint64_t</span>	addr;		<span class="comment">/* memory address of this section */</span></span><br><span class="line">	<span class="keyword">uint64_t</span>	<span class="built_in">size</span>;		<span class="comment">/* size in bytes of this section */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	offset;		<span class="comment">/* file offset of this section */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	align;		<span class="comment">/* section alignment (power of 2) */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	reloff;		<span class="comment">/* file offset of relocation entries */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	nreloc;		<span class="comment">/* number of relocation entries */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags (section type and attributes)*/</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	reserved1;	<span class="comment">/* reserved (for offset or index) */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	reserved2;	<span class="comment">/* reserved (for count or sizeof) */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	reserved3;	<span class="comment">/* reserved */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>解析出值如下，根据 <code>sectname</code> 为 <code>__text</code>，可以看出这是一个代码段。根据 <code>offset</code> 和 <code>size</code> 可以知道该代码段在文件中的具体值</p>
<table>
<thead>
<tr>
<th>name</th>
<th>offset</th>
<th>value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sectname</td>
<td>0x00000068</td>
<td>5f5f 7465 7874 0000 0000 0000 0000 0000</td>
<td>ascii 解析为 “__text”</td>
</tr>
<tr>
<td>segname</td>
<td>0x00000078</td>
<td>5f5f 5445 5854 0000 0000 0000 0000 0000</td>
<td>ascii 解析为 “__TEXT”</td>
</tr>
<tr>
<td>addr</td>
<td>0x00000088</td>
<td>0x0000000000000000</td>
<td>Address，内存地址，目前为0，链接时会重定向</td>
</tr>
<tr>
<td>size</td>
<td>0x00000090</td>
<td>0x0000000000000012</td>
<td>Size,该section的size</td>
</tr>
<tr>
<td>offset</td>
<td>0x00000098</td>
<td>0x000001d8</td>
<td>该section在main.o文件的offset</td>
</tr>
<tr>
<td>align</td>
<td>0x0000009c</td>
<td>0x00000004</td>
<td>内存对齐数值</td>
</tr>
<tr>
<td>reloff</td>
<td>0x000000a0</td>
<td>0x00000000</td>
<td>Relocations Offset,重定向偏移地址</td>
</tr>
<tr>
<td>nreloc</td>
<td>0x000000a4</td>
<td>0x00000000</td>
<td>Number of Relocations,重定向数</td>
</tr>
<tr>
<td>flags</td>
<td>0x000000a8</td>
<td>0x80000400</td>
<td>Flags,S_REGULAR,S_ATTR_PURE_INSTRUCTIONS,S_ATTR_SOME_INSTRUCTIONS</td>
</tr>
<tr>
<td>reserved1</td>
<td>0x000000ac</td>
<td>0x00000000</td>
<td>Reserved1</td>
</tr>
<tr>
<td>reserved2</td>
<td>0x000000b0</td>
<td>0x00000000</td>
<td>Reserved2</td>
</tr>
<tr>
<td>reserved3</td>
<td>0x000000b4</td>
<td>0x00000000</td>
<td>Reserved3</td>
</tr>
</tbody>
</table>
<h4 id="section-64-的-content"><a href="#section-64-的-content" class="headerlink" title="section_64 的 content"></a>section_64 的 content</h4><p>我们从 <code>0x000001d8</code> 来解析 <code>0x12</code> 个字节<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">000001</span>d0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">5548</span> <span class="number">89e5</span> c745 fc00  ........UH...E..</span><br><span class="line"><span class="number">000001e0</span>: <span class="number">0000</span> <span class="number">00</span>b8 <span class="number">0200</span> <span class="number">0000</span> <span class="number">5</span>dc3 <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ........].......</span><br></pre></td></tr></table></figure></p>
<p>这是一段机器码，翻译为汇编如下<br><figure class="highlight as"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x000001d8</span> <span class="number">55</span>            pushq %rbp</span><br><span class="line"><span class="number">0x000001d9</span> <span class="number">4889e5</span>        movq  %rsp,%rbp</span><br><span class="line"><span class="number">0x000001dc</span> c745fc00000000 movl   $<span class="string">"0x0 (_main)"</span>,<span class="number">-0x4</span>(%rbp)</span><br><span class="line"><span class="number">0x000001e3</span> b80x000000     movl  $<span class="number">0x2</span>,%eax</span><br><span class="line"><span class="number">0x000001e8</span> <span class="number">5</span>d            popq   %rbp</span><br><span class="line"><span class="number">0x000001e9</span> c3            ret</span><br></pre></td></tr></table></figure></p>
<h3 id="符号表-LC-SYMTAB"><a href="#符号表-LC-SYMTAB" class="headerlink" title="符号表 LC_SYMTAB"></a>符号表 LC_SYMTAB</h3><p>第三个 Load Command 表示符号表，结构体如下<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">symtab_command</span> &#123;</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	cmd;		<span class="comment">/* LC_SYMTAB */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	cmdsize;	<span class="comment">/* sizeof(struct symtab_command) */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	symoff;		<span class="comment">/* symbol table offset */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	nsyms;		<span class="comment">/* number of symbol table entries */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	stroff;		<span class="comment">/* string table offset */</span></span><br><span class="line">	<span class="keyword">uint32_t</span>	strsize;	<span class="comment">/* string table size in bytes */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>解析出值如下，从中我们可以得出符号表的 <code>offset</code> 是 <code>0x00000258</code> ，符号数量 <code>1</code> ，以及字符串表的 <code>offset</code> 是 <code>0x00000268</code> ， <code>size</code> 是 <code>0x0000000b</code>。</p>
<table>
<thead>
<tr>
<th>name</th>
<th>offset</th>
<th>value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cmd</td>
<td>0x00000170</td>
<td>0x00000002</td>
<td>LC_SYMTAB</td>
</tr>
<tr>
<td>cmdsize</td>
<td>0x00000174</td>
<td>0x00000018</td>
<td>Command Size</td>
</tr>
<tr>
<td>symoff</td>
<td>0x00000178</td>
<td>0x00000258</td>
<td>符号表在文件中的offset</td>
</tr>
<tr>
<td>nsyms</td>
<td>0x0000017c</td>
<td>0x00000001</td>
<td>符号数量</td>
</tr>
<tr>
<td>stroff</td>
<td>0x00000180</td>
<td>0x00000268</td>
<td>字符串表在文件中的offset</td>
</tr>
<tr>
<td>strsize</td>
<td>0x00000184</td>
<td>0x0000000b</td>
<td>字符串表长度</td>
</tr>
</tbody>
</table>
<p>我们从 <code>0x00000258</code> 来查看符号表，根据结构体 <code>nlist_64</code> 来解析。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is the symbol table entry structure for 64-bit architectures.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">nlist_64</span> &#123;</span></span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">uint32_t</span>  n_strx; <span class="comment">/* index into the string table */</span></span><br><span class="line">    &#125; n_un;</span><br><span class="line">    <span class="keyword">uint8_t</span> n_type;        <span class="comment">/* type flag, see below */</span></span><br><span class="line">    <span class="keyword">uint8_t</span> n_sect;        <span class="comment">/* section number or NO_SECT */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> n_desc;       <span class="comment">/* see &lt;mach-o/stab.h&gt; */</span></span><br><span class="line">    <span class="keyword">uint64_t</span> n_value;      <span class="comment">/* value of this symbol (or stab offset) */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>name</th>
<th>offset</th>
<th>value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>n_un.n_strx</td>
<td>0x00000258</td>
<td>0x00000001</td>
<td>在字符串表中的偏移量</td>
</tr>
<tr>
<td>n_type</td>
<td>0x0000025c</td>
<td>0x0000000f</td>
<td>代表 N_EXT,N_SECT。N_EXT 代表支持外部符号引用，N_SECT 表示该符号定义在索引为 n_sect 的 Section</td>
</tr>
<tr>
<td>n_sect</td>
<td>0x0000025d</td>
<td>0x00000001</td>
<td>符号表在 Section 里的索引号</td>
</tr>
<tr>
<td>n_desc</td>
<td>0x0000025e</td>
<td>0x0000</td>
<td>–</td>
</tr>
<tr>
<td>n_value</td>
<td>0x00000260</td>
<td>0x0000000000000000</td>
<td>–</td>
</tr>
</tbody>
</table>
<h3 id="字符串表"><a href="#字符串表" class="headerlink" title="字符串表"></a>字符串表</h3><p>从符号表解析得知字符串表的 <code>offset</code> 为 <code>0x00000268</code><br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00000268</span> <span class="number">00</span> <span class="number">5f</span> <span class="number">6</span>d <span class="number">61</span> <span class="number">69</span> <span class="number">6</span>e <span class="number">00</span> <span class="number">00</span></span><br></pre></td></tr></table></figure></p>
<p>而唯一的符号，在字符串表的位置是 1，从 <code>0x269</code> 开始读，读到 <code>00</code> 终止，根据 <a href="http://www.asciitable.com/" target="_blank" rel="noopener">ascii</a> 可以得知其符号名为 <code>_main</code>，对应源文件里的<code>main</code>函数。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>第一个 Segment 还包括的 Section 有 __compact_unwind、__eh_frame、reloadcations，跟 debug 调试有关，这里就不多讲了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>ascii 表<br><a href="https://www.asciitable.com" target="_blank" rel="noopener">https://www.asciitable.com</a></li>
<li>apple 开源的 mach-o/loader.h<br> <a href="https://opensource.apple.com/source/cctools/cctools-795/include/mach-o/loader.h" target="_blank" rel="noopener">https://opensource.apple.com/source/cctools/cctools-795/include/mach-o/loader.h</a></li>
<li>《深入理解计算机系统》</li>
<li>《程序员的自我修养》</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/01/2019summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/01/2019summary/" class="post-title-link" itemprop="url">2019 年终总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-01 08:48:19" itemprop="dateCreated datePublished" datetime="2020-01-01T08:48:19+08:00">2020-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-06 12:43:29" itemprop="dateModified" datetime="2020-01-06T12:43:29+08:00">2020-01-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>子在川上曰：逝者如斯夫！不舍昼夜。</p>
</blockquote>
<h3 id="读过的书"><a href="#读过的书" class="headerlink" title="读过的书"></a>读过的书</h3><p>今年买了很多书，却没有读多少。<br>《计算机组成原理与汇编语言程序设计》和《程序员的自我修养》补了计算机的基础知识，《剑指 Offer》补了算法知识。<br>《万历十五年》现在回忆起来，只记得一代首辅张居正、模范官员海瑞、抗倭英雄戚继光等人的名字了，惭愧。<br>《他改变了中国》让我知道现在的幸福生活来之不易，一个人的一生呐真的是要靠自己的奋斗的。<br>《乔布斯传》了解了这位改变了互联网的天才的生平。他非凡的运营能力、偏执狂一般对硬件以及软件的把控欲，造就了如今的苹果帝国。<a href="https://zh.wikipedia.org/wiki/%E4%B8%8D%E5%90%8C%E5%87%A1%E6%83%B3" target="_blank" rel="noopener">Think Different</a> 震撼到我了，我决定打印出来挂到墙上。<br>《上帝掷骰子吗:量子物理史话》，一次从古希腊到二十一世纪的量子之旅，在这里我重新认识了光，也见识到了物理的伟大。<br>《球状闪电》在我看来是一次理工男的量子物理的浪漫旅途。<br>还读了兰陵笑笑生的《金瓶梅》。人性呐，从人类社会起，就没变过。</p>
<h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h3><p>今年产出了三篇博客，数量较少。<br>在配置 <a href="https://nginx.org" target="_blank" rel="noopener">Nginx</a> 主页的时候，碰到了 403 问题，寻根究底，产出了<b><a href="/2019/04/22/nginx-user-403/" title="NGINX 用户权限引起的 403 问题">NGINX 用户权限引起的 403 问题</a></b>。<br>工作中尝试了 <a href="https://github.com/ReactiveX/RxSwift" target="_blank" rel="noopener">RxSwift</a>，给同事们做了分享，产出了<b><a href="/2019/05/13/rxSwift-learn-one/" title="响应式编程 与 RXSwift（一）">响应式编程 与 RXSwift（一）</a></b>，当时是想写一个系列的，现在看来应该是烂尾了。<br>在看《程序员的自我修养》时，了解了目标文件的结构，于是对计算机的字符编码比较好奇，产出了<b><a href="/2019/12/23/what-is-utf8/" title="UTF-8 字符编码">UTF-8 字符编码</a></b>。<br>以后我要多写博客，不管是生活上还是专业上，这其实也是一个归纳总结的过程，自己也能受益良多。否则就像春风拂面一样，过程很爽，但是过去就忘了。</p>
<h3 id="刷题"><a href="#刷题" class="headerlink" title="刷题"></a>刷题</h3><p>今年花了一些精力刷题，维护了一个使用 <a href="https://golang.org/" target="_blank" rel="noopener">Go</a> 刷 <a href="https://leetcode.com/problemset/all/" target="_blank" rel="noopener">LeetCode</a> 的<a href="https://github.com/jokerYellow/LeetCodeGo" target="_blank" rel="noopener">开源项目</a>，记录自己刷题的过程，同时勉励自己坚持下去。<br>之前有人问我，刷算法除了面试之外有啥用？我觉得有很多好处，一个是培养解决问题的思路，一个是保持思考的习惯，同时代码也会写的越来越健壮。</p>
<h3 id="罗大佑-amp-北京"><a href="#罗大佑-amp-北京" class="headerlink" title="罗大佑 &amp; 北京"></a>罗大佑 &amp; 北京</h3><p>跟媳妇都是罗大佑的脑残粉。在今年六月份，特地去北京工体看了罗大佑的演唱会，满足了自己的小心愿。<br>顺道也游览了故宫、圆明园。同时作为一个吃货，在大众点评上找了家卤煮火烧过了嘴瘾。</p>
<h3 id="交房"><a href="#交房" class="headerlink" title="交房"></a>交房</h3><p>国庆的时候交房了。接着就忙着看家具、打柜子、做窗帘、封阳台等一系列事情。<br>刚开始买床买家具的时候，东挑西挑，各种参数对比，查询各指标的意思，浪费了很多精力。后来我想开了，就买品牌货，价钱符合预期，就行了。<br>空空的房子慢慢的被填满，渐渐的有了家的感觉。终于要住进自己的窝了，嗨，不容易。</p>
<h3 id="健康问题"><a href="#健康问题" class="headerlink" title="健康问题"></a>健康问题</h3><p>年末体检，查出了一点小问题。于是下决心找了私教，逼自己体重降下来，每次咔咔练完，全身一阵酸爽。同时对健康饮食也有了一些认识，以少油、少盐、少糖、营养均衡的原则来吃就对了。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>读的书比去年多，刷的题比去年多，写的博客比去年多，哈哈，总的来说，凑合。<br>同时，我也迈进了三十岁的门槛，来到了能力最强以及时间最宝贵的关口，只有继续战斗了。</p>
<h5 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h5><ol>
<li>2020-1-6，翻阅亚马逊书籍，发现自己在2019年有读过《上帝掷骰子吗:量子物理史话》，并且做过分享。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/23/what-is-utf8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/23/what-is-utf8/" class="post-title-link" itemprop="url">UTF-8 字符编码</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-23 21:16:59" itemprop="dateCreated datePublished" datetime="2019-12-23T21:16:59+08:00">2019-12-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-08 18:33:19" itemprop="dateModified" datetime="2020-01-08T18:33:19+08:00">2020-01-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>问题  </p>
<blockquote>
<p><code>11100110 10110001 10011111</code>表示什么？</p>
</blockquote>
<h4 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h4><blockquote>
<p>American Standard Code for Information Interchange，美国信息交换标准代码 </p>
</blockquote>
<p><code>ASCII</code>最初由美国提出，解决了英语世界在计算机里的编码问题。<br><code>ASCII</code>从<code>00</code>开始，一直到<code>7f</code>，包含了<code>128</code>个字符，其中<code>33</code>个控制字符，<code>95</code>个可见字符。</p>
<ol>
<li>控制字符比较常见的如换行键、空字符、退出键等。</li>
<li>可见字符如空格、数字、大小写字母、符号等。</li>
</ol>
<p>可以通过<code>echo</code>配合<code>xxd</code>命令很简单的获取字符的<code>ASCII</code>值，如下我们就拿到了<code>a</code>的<code>ASCII</code>值为<code>0x61</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> a | xxd</span></span><br><span class="line">00000000: 610a                          a.</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> a | xxd -b                     </span></span><br><span class="line">00000000: 01100001 00001010              a.</span><br></pre></td></tr></table></figure></p>
<p>随着互联网在全世界的普及，<code>ASCII</code>的局限性慢慢凸显，其无法表示其他语种如汉语、日语的字符。于是发展出了<code>Unicode</code>。</p>
<h4 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h4><blockquote>
<p>Unicode，又称为万国码、国际码、统一码、单一码</p>
</blockquote>
<p><code>Unicode</code>是一项业界标准，为每一个字符都制定了唯一的编码，统一了各语种的编码。<br>比如<code>U+0061</code>表示<code>a</code>，<code>U+660e</code>代表汉字的<code>明</code>字，<code>U+1f600</code>表示露齿而笑的脸<code>😀</code>,<code>U+1F1F3</code>表示中国国旗<code>🇨🇳</code></p>
<p><code>Unicode</code>里一个字型可以代表多种字符编码，甚至是某些编码的组合。<br>如<code>é</code>既可以用<code>U+00e9</code>表示，也可以用<code>U+0065U+0301</code>的组合表示。所以我们使用的时候，还是得根据实际使用的意义来输入，否则在计算长度以及字符串比较等方面就会不一致，造成不必要的麻烦，而且这些问题排查起来也很困难。</p>
<h4 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h4><blockquote>
<p>8-bit Unicode Transformation Format</p>
</blockquote>
<p><code>UTF-8</code>是一种针对<code>Unicode</code>的可变长度字符编码，是一种前缀码。</p>
<ol>
<li><code>128</code>个<code>US-ASCII</code>字符只需一个字节编码（<code>Unicode</code>范围由<code>U+0000</code>至<code>U+007F</code>）</li>
<li>带有附加符号的拉丁文、希腊文、西里尔字母、亚美尼亚语、希伯来文、阿拉伯文、叙利亚文及它拿字母则需要两个字节编码（<code>Unicode</code>范围由<code>U+0080</code>至<code>U+07FF</code>）</li>
<li>其他基本多文种平面（<code>BMP</code>）中的字符（这包含了大部分常用字，如大部分的汉字）使用三个字节编码（<code>Unicode</code>范围由<code>U+0800</code>至<code>U+FFFF</code>）</li>
<li>其他极少使用的<code>Unicode</code>辅助平面的字符使用四至六字节编码（<code>Unicode</code>范围由<code>U+10000</code>至<code>U+1FFFFF</code>使用四字节，<code>Unicode</code>范围由<code>U+200000</code>至<code>U+3FFFFFF</code>使用五字节，<code>Unicode</code>范围由<code>U+4000000</code>至<code>U+7FFFFFFF</code>使用六字节）。</li>
</ol>
<table>
<thead>
<tr>
<th>代码范围</th>
<th>标量值</th>
<th>UTF-8</th>
<th>注释</th>
<th>个数</th>
</tr>
</thead>
<tbody>
<tr>
<td>000000 - 00007f</td>
<td>00000000 00000000 0zzzzzzz</td>
<td>00-f7</td>
<td>ASCII，字节由0开始</td>
<td>128</td>
</tr>
<tr>
<td>000080 - 0007ff</td>
<td>00000000 00000yyy yyzzzzzz</td>
<td>110yyyyy 10zzzzzz</td>
<td>第一个字节由110开始，接着的字节由10开始</td>
<td>1920</td>
</tr>
<tr>
<td>000800 - 00d7ff , 00e000 - 00ffff</td>
<td>00000000 xxxxyyyy yyzzzzzz</td>
<td>1110xxxx 10yyyyyy 10zzzzzz</td>
<td>第一个字节由1110开始，接着的字节由10开始</td>
<td>61440</td>
</tr>
<tr>
<td>010000 - 10ffff</td>
<td>000wwwxx xxxxyyyy yyzzzzzz</td>
<td>11110www 10xxxxxx 10yyyyyy 10zzzzzz</td>
<td>第一个字节由11110开始，接着的字节由10开始</td>
<td>1048576</td>
</tr>
</tbody>
</table>
<blockquote>
<p><code>Unicode</code>在范围<code>D800-DFFF</code>中不存在任何字符，基本多文种平面中约定了这个范围用于<code>UTF-16</code>扩展标识辅助平面（两个<code>UTF-16</code>表示一个辅助平面字符）。当然，任何编码都是可以被转换到这个范围，但在<code>Unicode</code>中他们并不代表任何合法的值。</p>
</blockquote>
<p>根据上面的表可见，<code>UTF-8</code>完美兼容<code>ASCII</code>编码，<code>Unicode</code>范围很大，而且是可以继续扩展的<br>同时我们可以根据<code>Unicode</code>值推导出<code>UTF-8</code>的编码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">A[Unicode:黄,U+9ec4] --&gt;|二进制| B(1001 1110 1100 0100)</span><br><span class="line">B --&gt; |UTF-8| C(11101001 10111011 10000100)</span><br><span class="line">C --&gt; |十六进制| D(UTF-8:e9bb84)</span><br></pre></td></tr></table></figure></p>
<p>现在我们回到文章开头的问题</p>
<blockquote>
<p><code>11100110 10110001 10011111</code>表示什么？</p>
</blockquote>
<p>可以看出这段二进制编码实际上是<code>UTF-8</code>编码，按照上表的规则，可以推导出其<code>Unicode</code>字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph TD </span><br><span class="line">B(11100110  10110001 10011111) --&gt; |Unicode| C(0110 1100 0101 1111)</span><br><span class="line">C --&gt; |十六进制| D(Unicode:江,U+6c5f)</span><br></pre></td></tr></table></figure>
<h4 id="应用：修改机器码字符段"><a href="#应用：修改机器码字符段" class="headerlink" title="应用：修改机器码字符段"></a>应用：修改机器码字符段</h4><p>学以致用，这样效果才会好<br>这是一段简单的输出字符串的程序<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"hello,world!黄"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>编译<br><code>$ gcc main.c | ./a.out</code><br>输出：<code>hello,world!黄</code></p>
<p>查看目标文件的段信息<br><code>$ objdump -s a.out</code><br>输出里的字符段如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Contents of section __cstring:</span><br><span class="line"> 100000fa2 68656c6c 6f2c776f 726c6521 e9bb8400  hello,world!....</span><br></pre></td></tr></table></figure><br>我们可以知道，这一串十六进制编码代表了<code>UTF-8</code>编码的<code>hello,world!黄</code>。可以尝试对其进行修改<br><code>vim -b a.out</code><br>打开十六进制模式<br><code>%!xxd</code><br>查找到hello部分进行修改<br><code>/hello</code><br>恢复成二进制模式<br><code>%!xxd -r</code><br>保存退出<br><code>wq!</code><br>查看字符段<br><code>$ objdump -s a.out</code><br>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Contents of section __cstring:</span><br><span class="line"> 100000fa2 68656c6c 6f2c776f 726c6521 e9bb8400  hello,world!....</span><br></pre></td></tr></table></figure></p>
<p><code>$ ./a.out</code><br>输出：<code>hello,world!江</code><br>这样，我们就修改了机器码。</p>
<p>到这里，笔者也想通了一些问题，比如<code>hardCode</code>进代码里的密钥肯定是不安全的，存在被查看以及被篡改的风险；二进制文件也是不安全的，所以<code>Apple</code>使用了代码签名的机制，来保证设备上运行的代码是未被篡改过的。</p>
<h6 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h6><ul>
<li>ascii：<a href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/ASCII</a></li>
<li>unicode：<a href="https://home.unicode.org/" target="_blank" rel="noopener">https://home.unicode.org/</a></li>
<li>emoji：<a href="http://unicode.org/emoji/charts/full-emoji-list.html" target="_blank" rel="noopener">http://unicode.org/emoji/charts/full-emoji-list.html</a></li>
<li>汉字对应的unicode：<a href="http://www.chi2ko.com/tool/CJK.htm" target="_blank" rel="noopener">http://www.chi2ko.com/tool/CJK.htm</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/13/rxSwift-learn-one/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/13/rxSwift-learn-one/" class="post-title-link" itemprop="url">响应式编程 与 RXSwift（一）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-13 20:55:22" itemprop="dateCreated datePublished" datetime="2019-05-13T20:55:22+08:00">2019-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-24 19:17:40" itemprop="dateModified" datetime="2019-12-24T19:17:40+08:00">2019-12-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我想从 <strong>what</strong>、<strong>how</strong>、<strong>why</strong> 几个方面，简单的写一下如何用 <strong>RXSwift</strong> 写响应式代码。</p>
<h1 id="what-is-RxSwift"><a href="#what-is-RxSwift" class="headerlink" title="what is RxSwift?"></a>what is RxSwift?</h1><p>在计算机中，<strong>响应式编程</strong>是一种面向<strong>数据流</strong>和<strong>变化传播</strong>的<strong>异步编程范式</strong>。<br>举个例子：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span> = b + c</span><br></pre></td></tr></table></figure>
<p>在<strong>命令式编程</strong>中，这个表达式是计算 b 和 c 的和 a。假如之后 b 和 c 变化了，a 也不会变化。<br>而在<strong>响应式编程</strong>里，a 会随着 b 和 c 的变化而变化，不用再次执行这块代码求出一个值，再赋值给 a。<br>响应式编程可以简化交互式用户界面的开发，比如将视图与数据流绑定，数据流有新的值的时候，视图则会自动响应变化。<br><strong>ReactiveX</strong> 是一组提供异步的数据流的 api，在 <strong>ReactiveX</strong> 的眼中，一切都可以当作数据流，我们可以用它来轻松的开始响应式编程。<br>而 <strong>RxSwift</strong> 就是 <strong>ReactiveX</strong> 的 Swift 实现。</p>
<h1 id="how-to-use-RxSwift？"><a href="#how-to-use-RxSwift？" class="headerlink" title="how to use RxSwift？"></a>how to use RxSwift？</h1><p>怎么用好 <strong>RxSwift</strong> 呢？使用 <strong>RxSwift</strong> 的关键，是如何转变思维，写出响应式代码。<br>举个例子，在登录页面，会对账号和密码的输入框做校验，账号限制为 11 位字符，密码限制为 6 到 20 个字符，只有在账号和密码都有效的情况下，登录按钮才可点击。</p>
<h2 id="命令式编程"><a href="#命令式编程" class="headerlink" title="命令式编程"></a>命令式编程</h2><p><strong>在命令式编程下的典型思路是这样的 </strong><br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 实现账号 TextField 以及密码 TextField 的 delegate 的字符串变化的方法，获取到他们的字符串</span><br><span class="line"><span class="number">2.</span> 根据字符串的变化，设置登录按钮的enable状态</span><br></pre></td></tr></table></figure><br>具体实现我就不写了，相信大家已经写了很多遍了</p>
<h2 id="响应式编程"><a href="#响应式编程" class="headerlink" title="响应式编程"></a>响应式编程</h2><p><strong>在响应式编程下的典型思路是这样</strong><br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 获取账号和密码的字符流 <span class="keyword">user</span>NameInputStream、<span class="built_in">pass</span>WordInputStream</span><br><span class="line"><span class="number">2</span>. 将账号流转换为账号是否有效的流 <span class="keyword">user</span>NameValidStream、<span class="built_in">pass</span>WordValidStream</span><br><span class="line"><span class="number">3</span>. 将 <span class="keyword">user</span>NameValidStream、<span class="built_in">pass</span>WordValidStream 两个流合并为判断账号和密码是否有效的流 loginValidStream</span><br><span class="line"><span class="number">4</span>. 将 loginValidStream 与登录按钮绑定</span><br></pre></td></tr></table></figure><br><strong>流程如图</strong><br><img src="/images/loginStream.jpg" alt="登录按钮流"></p>
<p><strong>show you the code</strong><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> passWordField: <span class="type">UITextField!</span> </span><br><span class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> userNameField: <span class="type">UITextField!</span> </span><br><span class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> loginButton: <span class="type">UIButton!</span> </span><br><span class="line"><span class="keyword">let</span> bag = <span class="type">DisposeBag</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">bindView</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//生成流</span></span><br><span class="line">    <span class="keyword">let</span> passWordInput = <span class="keyword">self</span>.passWordField.rx.text</span><br><span class="line">    <span class="keyword">let</span> userNameInput = <span class="keyword">self</span>.userNameField.rx.text</span><br><span class="line">    <span class="comment">//转换流</span></span><br><span class="line">    <span class="keyword">let</span> passWordValid = passWordInput.<span class="built_in">map</span> &#123; (passWord) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> passWord = passWord&#123;</span><br><span class="line">            <span class="keyword">return</span> passWord.<span class="built_in">count</span> &gt; <span class="number">6</span> &amp;&amp; passWord.<span class="built_in">count</span> &lt; <span class="number">20</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> userNameValid = userNameInput.<span class="built_in">map</span> &#123; (userName) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> userName = userName &#123;</span><br><span class="line">            <span class="keyword">return</span> userName.<span class="built_in">count</span> == <span class="number">11</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//合并流</span></span><br><span class="line">    <span class="keyword">let</span> loginValid = <span class="type">Observable</span>&lt;<span class="type">Bool</span>&gt;.combineLatest(userNameValid, passWordValid) &#123; (userName, passWord) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> userName &amp;&amp; passWord</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    loginValid.bind(to: <span class="keyword">self</span>.loginButton.rx.isEnabled).disposed(by: bag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看出这些代码主要在做的事情，就是流的生成、转换、合并，以及最后与 UI 的绑定。代码看起来也很直观，业务逻辑一目了然，减少了潜在性的错误。</p>
<h1 id="why-RxSwift？"><a href="#why-RxSwift？" class="headerlink" title="why RxSwift？"></a>why RxSwift？</h1><p>RxSwift 是一个利器，而且它的扩展库 RxCocoa 将 UIKit 里的大部分 UI 控件做了 Reactive 化，可以很方便的对控件进行数据绑定，以及监控控件的变化。使用 RxSwift 我们可以省去命令式编程下的很多胶水代码，通过流的转换合并，轻易的写出复杂的逻辑。<br>响应式编程的难点一个是学习曲线比较陡峭，一个是思维转换比较困难，踏过这两个坎之后，就会发现一个新世界了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/22/nginx-user-403/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/22/nginx-user-403/" class="post-title-link" itemprop="url">NGINX 用户权限引起的 403 问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-22 20:23:20 / 修改时间：21:11:23" itemprop="dateCreated datePublished" datetime="2019-04-22T20:23:20+08:00">2019-04-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>在 CentOS 上安装完 NGINX 之后，尝试修改 NGINX 的 root 地址</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line">http&#123;</span><br><span class="line">    server&#123;</span><br><span class="line">        root <span class="string">/root/blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>在 root 用户下，新建文件夹 blog 如下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--root</span></span><br><span class="line">    <span class="comment">--blog</span></span><br><span class="line">        <span class="keyword">index</span>.html</span><br></pre></td></tr></table></figure>
<p>重启 NGINX 服务</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">service nginx reload</span></span><br></pre></td></tr></table></figure>
<p>访问 HTTP 80 端口</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl 0.0.0.0:80</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>403 Forbidden<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">bgcolor</span>=<span class="string">"white"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>403 Forbidden<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx/1.12.2<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="排查"><a href="#排查" class="headerlink" title="排查"></a>排查</h1><p>排查错误日志，发现为<code>Permission denied</code>权限错误</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tail /var/log/nginx/error.log</span><br><span class="line"></span><br><span class="line"><span class="number">2019</span>/<span class="number">04</span>/<span class="number">22</span> <span class="number">20</span>:<span class="number">36</span>:<span class="number">47</span> [error] <span class="number">26764</span>#<span class="number">0</span>: *<span class="number">68</span> <span class="string">"/root/blog/index.html"</span> <span class="keyword">is</span> forbidden (<span class="number">13</span>: Permission denied), client: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>, server: _, request: <span class="string">"GET / HTTP/1.1"</span>, host: <span class="string">"0.0.0.0"</span></span><br></pre></td></tr></table></figure>
<p>查看 NGINX 的进程用户，发现 NGINX 的 worker 进程为 NGINX 用户启动的</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ps -aux | grep nginx</span><br><span class="line">root     <span class="number">26085</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">125720</span>  <span class="number">5268</span> ?        Ss   <span class="number">17</span>:<span class="number">05</span>   <span class="number">0</span>:<span class="number">00</span> nginx: master process /usr/sbin/nginx</span><br><span class="line">nginx    <span class="number">26764</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">126140</span>  <span class="number">4224</span> ?        S    <span class="number">19</span>:<span class="number">34</span>   <span class="number">0</span>:<span class="number">00</span> nginx: worker process</span><br><span class="line">nginx    <span class="number">26765</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">126140</span>  <span class="number">4224</span> ?        S    <span class="number">19</span>:<span class="number">34</span>   <span class="number">0</span>:<span class="number">00</span> nginx: worker process</span><br><span class="line">root     <span class="number">26955</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">112660</span>   <span class="number">976</span> pts/<span class="number">5</span>    S+   <span class="number">20</span>:<span class="number">41</span>   <span class="number">0</span>:<span class="number">00</span> grep --color=<span class="built_in">auto</span> nginx</span><br></pre></td></tr></table></figure>
<p>查看 root 文件夹的用户权限，发现 root 文件夹的其他用户只有读权限，这样 NGINX 用户是无法访问的，于是可以理解为何报错 403 了。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l</span><br><span class="line"></span><br><span class="line">dr-xr-xr--. <span class="number">10</span> root root  <span class="number">4096</span> Apr <span class="number">22</span> <span class="number">20</span>:<span class="number">35</span> root</span><br></pre></td></tr></table></figure>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><h4 id="简单粗暴法"><a href="#简单粗暴法" class="headerlink" title="简单粗暴法"></a>简单粗暴法</h4><p>将 nginx.conf 的 user 修改为 root，这样 worker 进程是在 root 用户下启动的，可以顺利访问 /root/blog 文件夹。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">user</span> <span class="title">root</span>;</span><br></pre></td></tr></table></figure>
<h4 id="更安全的方法"><a href="#更安全的方法" class="headerlink" title="更安全的方法"></a>更安全的方法</h4><p>上述方法让 root 用户跑 worker 进程，太危险了。其实可以新建一个账号，在该账号下放置静态文件，然后将其权限暴露，这种做法更加安全。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>adduser www</span><br><span class="line"><span class="variable">$ </span>passwd  www</span><br><span class="line"><span class="variable">$ </span>cp -R /root/blog /home/www/</span><br><span class="line"><span class="variable">$ </span>chmod <span class="number">755</span> /home/www</span><br></pre></td></tr></table></figure>
<p>再将 nginx.conf 的 root 地址修改为<code>/home/www/blog</code></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    server&#123;</span><br><span class="line"><span class="symbol">        root:</span><span class="meta-keyword">/home/</span>www/blog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，就能正常访问 root 主页了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/09/2018summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/09/2018summary/" class="post-title-link" itemprop="url">2018流水账</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-01-09 19:01:44" itemprop="dateCreated datePublished" datetime="2019-01-09T19:01:44+08:00">2019-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-04 21:42:14" itemprop="dateModified" datetime="2019-02-04T21:42:14+08:00">2019-02-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>思来想去，还是要对 2018 年做个记录。</p>
<h1 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h1><p>在今年的十月六号，在老家举办了婚礼，跟对象走进了婚姻的殿堂。<br>感谢我的妻子的理解，以及对我的包容。<br>从此以后，我的人生之路，有了贤妻陪伴，特别好。<br>还有一件事情就是开始还房贷了，每个月五千的房贷，三千的装修贷，两千的房租。<br>人的一生呐还是要靠自己的奋斗，要是在 2017 年，我是不敢想象我能扛起来的。<br>2019 年 9 月交房。</p>
<h1 id="旅游"><a href="#旅游" class="headerlink" title="旅游"></a>旅游</h1><p>跟老婆一起去了趟美丽的开远参加昂然兄的婚礼，多年未见的大学同学聚了聚。<br>吃了米线、卷粉、烧烤、烧豆腐、竹荪山药鸡，非常感谢昂然兄的款待，云南的吃，特别好。<br>顺道去了普者黑，普者黑的水，特别好。<br>倒是没有去云大看看，有点遗憾。</p>
<h1 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h1><p>血源很合我的胃口，玩通了一周目，虽然虐的我不要不要的，但是那种痛快的杀戮感，特别好。<br>入了怪物猎人，玩不下去，还是喜欢魂系列。<br>还有 Diablo3，玩了下 NEC，最近开始玩 DH，真香。<br>下载了很多其他游戏，都没时间或者精力去玩了。</p>
<h1 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h1><p>一直以来，生活一直向工作倾斜。<br>工作中，说的最多的一个字就是<b>苦</b>。<br>家和公司两点一线。<br>晚上十一二点回家，也是家常便饭，某些地方肯定是出了问题。<br>这样难免少了对妻子的陪伴，所以我特别感谢我的妻子的理解。<br>为了补偿，在我妻子生日那天，我特地请假，陪她去中山公园、万松园路转悠了下。吃了美味的公安石锅鱼杂，特别美好的一天。</p>
<h1 id="蜀道难"><a href="#蜀道难" class="headerlink" title="蜀道难"></a>蜀道难</h1><p>技术上，今年只是在搞工程了，没有深入。<br>接触了 Golang，不过都没有坚持下去，运用起来。可以说看完就忘，一方面自己没有去找应用场景，一方面也是往工作太倾斜，导致自己的时间比较少。<br>书籍买了不少，真看了的不多。<br>看过的有《程序员的自我修养》《高效能人士的7个习惯》《白鹿原》，一直在看《重构》、《HTTP权威指南》。<br>粗浅看了《海子的诗》，记住了如下两段：</p>
<blockquote>
<p>山后面是山，<br>天空上面是天空，<br>道路前面，还是道路。</p>
</blockquote>
<blockquote>
<p>走在路上，<br>放声歌唱，<br>大风吹过山岗，<br>上面是无边的天空。</p>
</blockquote>
<p>我很敬佩能坚持的人，粗浅看了《胡适留学日记》，胡适大佬每天记录一篇日记，记录了很多年。</p>
<h1 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h1><p>根据以往的经验，flag 仅仅是 flag，但是我觉得还是要说一下，立足长远来看。<br>三年的 flag 是不上班。<br>一年的 flag 是开一家淘宝店并且运营起来。<br>这个一年的 flag 是三年 flag 的一个具体实现途径。</p>
<p><em>以上，2018年大年三十晚。</em></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/23/learningrxswift/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/23/learningrxswift/" class="post-title-link" itemprop="url">学习 RxSwift</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-23 19:58:38" itemprop="dateCreated datePublished" datetime="2018-01-23T19:58:38+08:00">2018-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-21 20:52:03" itemprop="dateModified" datetime="2019-11-21T20:52:03+08:00">2019-11-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="rule-1"><a href="#rule-1" class="headerlink" title="rule 1"></a>rule 1</h1><ul>
<li>Sequences can have 0 or more elements.</li>
<li>Once an error or completed event is received, the sequence cannot produce any other element.</li>
<li>When a sequence sends the completed or error event all internal resources that compute sequence elements will be freed.</li>
<li>To cancel production of sequence elements and free resources immediately, call dispose on the returned subscription.</li>
</ul>
<h1 id="rule-2"><a href="#rule-2" class="headerlink" title="rule 2"></a>rule 2</h1><ul>
<li>onNext 没结束之前，onComplete、onError、onNext都不会开始执行</li>
<li>dispose被释放之后，其相关的订阅都会执行dispose</li>
<li>Observerable，subscribe是同步的</li>
<li>可被订阅者，被订阅者，可被订阅，之后发布消息</li>
<li>订阅者，订阅者发布消息</li>
</ul>
<h1 id="other"><a href="#other" class="headerlink" title="other"></a>other</h1><p>现在只是用熟练了绑定，监听。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/15/2017summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/15/2017summary/" class="post-title-link" itemprop="url">一个总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-15 22:34:39" itemprop="dateCreated datePublished" datetime="2018-01-15T22:34:39+08:00">2018-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-01-22 00:07:08" itemprop="dateModified" datetime="2018-01-22T00:07:08+08:00">2018-01-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一八年已经过去了百分之四，之前没有做过什么总结，不过去年确实值得说道说道。</p>
<p>我本打算年初的时候回武汉，但二月份的时候恋爱了，就是这么猝不及防。由于对象在无锡，我选择暂时不回武汉，继续在上海待着。</p>
<p>期间就是恋爱工作看书了。一直到下半年，跟女朋友达成回乡的共识，于是着手实施回武汉。由于工作原因，需要帮公司招个人，以及做一下工作交接，从原定的九月份，一直到十月份才终于算是完成任务。招人挺难的，主要是看缘分。最后招了一位当时从武汉来上海找工作的小伙子，虽然期间发生了一些意外，所幸最后还是顺利入职了。写到这里不禁要感慨下几年前自己背着个包来到上海，脑袋里空空如也，能走到现在这般，真是幸运。</p>
<p>十月国庆假期过后，武汉出台了<a href="http://www.wuhan.gov.cn/whszfwz/xwxx/whyw/201710/t20171016_139167.html" target="_blank" rel="noopener">大学生落户政策</a>，大学生可以无门槛购房了。</p>
<p>回武汉的第一时间，我就把户口落了。然后紧锣密鼓的开始看房，一开始在江夏那边看，定了个楼盘，然后就等着开盘。</p>
<p>在等待的过程中，我开始泡图书馆，每天从庙山坐城铁到武昌，然后乘公交到省图书馆。省图挺好的，有暖气、开水、Wi-Fi、插座，自习区里基本都是满的，氛围非常好，十分适合看书学习。过了几天寻思投投简历，招聘信息里看到了现在的公司，想起之前招的那位小伙子有跟我推荐这家公司，于是毫不犹豫的投了，顺利入职。</p>
<p>后来，江夏的那个楼盘通知我说不开盘了，得，继续看房吧。在同事的介绍下，去看了个光谷南的楼盘，捡了个漏，还剩几套没有卖出去。跟家里商量了下，决定买。但当时的钱离首付还差点，记得那天晚上，列了个名单，挨个打电话借钱，于是房子就这么地了，感谢借给我钱的亲朋好友。剩下的就是好好工作，好好睡觉，好好还债了。</p>
<p>其实回武汉的时候我是怀着一种苦大仇深的情绪的，因为印象中武汉的互联网环境真的不乐观，算是跟外面漂泊的自己和解了，有一种妥协的成分在里面。回来之后，很幸运的加入了现在非常棒的团队。武汉这几年招商引资，很多一线公司都来投资建厂，不得不说环境确实是变好了。个人的发展真的是跟历史的大进程息息相关呐，感谢武汉，感谢互联网时代。</p>
<p>好像没有说以后的事。最近写一些基础设施项目，有一些感悟。我觉得把大的方向定下来了，局部模块都是一个渐渐优化、渐渐积累的过程。比如这篇总结，我也是先搭个架子，优化了好多个版本，算是写出来了。生活也是一样，我也是满怀希望，相信未来的。扛着这么大的担子，真的只有继续努力了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/20/multithreading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/20/multithreading/" class="post-title-link" itemprop="url">闲话iOS多线程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-20 22:10:57" itemprop="dateCreated datePublished" datetime="2017-02-20T22:10:57+08:00">2017-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-21 20:46:39" itemprop="dateModified" datetime="2019-11-21T20:46:39+08:00">2019-11-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>随着硬件的发展和多核 CPU 的普及，CPU 的性能越来越强了。为了让 CPU 充分运转，聪明的计算机科学家设计出了多线程模式，一个线程也就是相应的一条代码路径，多线程就是多条代码路径。</p>
<h1 id="线程队列"><a href="#线程队列" class="headerlink" title="线程队列"></a>线程队列</h1><p>那么怎么控制这些代码路径呢，于是就应运而生了一些代码路径的组合，叫做线程队列。这些队列有不同的执行代码路径的方式，比如窜行执行、并行执行等。</p>
<p>##窜行队列<br>可以把窜行队列当作并行队列的特殊情况，也就是最大并发数量为1。执行完了一个代码路径之后，根据优先级等因素，接着执行下一个，并不保证严格按照先进先出的顺序执行。那么问题来了，假如要控制窜行队列的执行顺序该怎么办呢，于是有了依赖这个概念，也就是一个代码路径依赖于另外一些代码路径，等到它依赖的路径都执行完了，这一个代码路径才能上路，那么这样就能严格控制执行顺序了。</p>
<h2 id="并行队列"><a href="#并行队列" class="headerlink" title="并行队列"></a>并行队列</h2><p>并行队列呢，也能通过依赖控制好某些路径的先后顺序，但是这个并行出现的问题就是要知道并发出去的代码路径都已经执行完毕，要做下一步工作了，于是并行队列就提供了这个功能。并行队列的应用场景可以是一些相互之间没有影响的工作。</p>
<h2 id="取消队列执行"><a href="#取消队列执行" class="headerlink" title="取消队列执行"></a>取消队列执行</h2><p>怎么让一个正在执行的代码路径停止呢，建议的做法是，要经常性的在关键性的点检查当前的状态，假如当前处于canceled状态，则停止执行下去，而且这个代码路径也没有机会再次执行了。让一个队列停止，这个队列也只是将当前的代码路径的状态置为canceled，也不发配新的代码路径执行了，恢复之后会继续分配。</p>
<h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><p>既然是多线程，那么不可避免的会出现资源抢夺，于是锁出现了。有资源竞争的互斥锁，有适用于生产者消费者的条件锁，有适用于递归的递归锁。使用锁的过程中要时刻注意防止死锁的发生。把用于访问共享事物的代码块称为临界区。不能让一个临界区始终处于等待状态，也不能让一个临界区始终占有共享区间。</p>
<h2 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h2><p>互斥锁，只能对临界区加锁一次，不能对同一个线程加多次锁，这样会造成死锁。对临界区加锁的时候，如果临界区被使用了，则当前线程被阻塞，直到临界区被释放，轮到当前线程进入临界区。假如有多个线程处于等待状态，则根据优先级进行队列处理。</p>
<h2 id="条件锁"><a href="#条件锁" class="headerlink" title="条件锁"></a>条件锁</h2><p>比互斥锁多的一个是只有锁在特定条件下才能加锁，释放锁的时候可以指定锁的当前条件。适用于生产者消费者模式，一个线程负责生产，其他线程负责消费。负责生产的轮询进入临界区，条件则是一个判定是否要生产的条件，比如货物数量为10则开始生产，生产完毕后将条件设置为shouldProduct = false，消费线程可以进入临界区消费。负责消费的线程出临界区的时候，根据剩余数量判断是否需要生产，如需生产，则将条件shouldProduct = true，则生产线程进入临界区生产。</p>
<h2 id="递归锁"><a href="#递归锁" class="headerlink" title="递归锁"></a>递归锁</h2><p>当在递归情况下，使用互斥锁的时候，会造成死锁。这种情况下适用递归锁，允许在一个线程里多次加锁和解锁，当解锁次数跟加锁次数相等时，出临界区，由于要做额外的加锁次数判断，开销会比互斥锁大。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/04/React-Native-environment-setup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cuijian.jpg">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="我的精神家园">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/09/04/React-Native-environment-setup/" class="post-title-link" itemprop="url">React Native 初探一：Mac + iOS 开发环境搭建</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-09-04 18:50:01" itemprop="dateCreated datePublished" datetime="2016-09-04T18:50:01+08:00">2016-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-21 21:05:13" itemprop="dateModified" datetime="2019-11-21T21:05:13+08:00">2019-11-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><p>1 . 安装 node 和 watchman。</p>
<pre><code>brew install node
brew install watchman
</code></pre><p>2 . 安装 React Native。</p>
<pre><code>npm install -g react-native-cli
</code></pre><p>如遇到权限问题，请用</p>
<pre><code>sudo npm install -g react-native-cli
</code></pre><p>3 . 安装 Xcode，<a href="https://itunes.apple.com/us/app/xcode/id497799835?mt=12" target="_blank" rel="noopener">Mac App Store</a> 安装既可。<br>4 . 验证是否安装成功，可通过如下命令新建和启动项目试试。</p>
<pre><code>react-native init demoProject
cd demoProject
react-native run-ios
</code></pre><p>启动过程中如果遇到问题，可能是初始化中漏装了一个包，解决途径执行。</p>
<pre><code>npm install
</code></pre><p>再启动，网上下载的项目出现启动问题也可尝试执行此命令。</p>
<h2 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h2><p>1 . 接下来选择趁手的 IDE，尝试过 Sublime 和 atom 之后，目前我使用的 WebStorm + <a href="https://github.com/virtoolswebplayer/ReactNative-LiveTemplate" target="_blank" rel="noopener">ReactNative-LiveTemplate插件</a>。<br>2 . 日志可以在项目路径下执行以下命令查看。</p>
<pre><code>react-native log-ios
</code></pre><p>3 . Debug 起来也很方便，请先安装好 Chrome，在 iOS 模拟器中 <em>Command⌘ + D</em>，选择 <em>Debug JS Remotely</em>，就可以在 Chrome 愉快的 Debug 了，其它的选项也可以尝试一下。感慨 ReactNative 真是一个伟大的项目，前端真是神奇，FaceBook 真是一个伟大的公司。<br><strong>以上信息全部来自<a href="https://facebook.github.io/react-native/" target="_blank" rel="noopener">React Native官网</a>。</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="木鱼"
      src="/images/cuijian.jpg">
  <p class="site-author-name" itemprop="name">木鱼</p>
  <div class="site-description" itemprop="description">我的精神家园</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jokerYellow" title="GitHub → https://github.com/jokerYellow" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wandererswordsman@gmail.com" title="E-Mail → mailto:wandererswordsman@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-tree"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">木鱼</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.6.0
  </div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
















  

  

</body>
</html>
